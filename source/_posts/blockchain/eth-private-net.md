---
<<<<<<< HEAD
=======
<<<<<<< HEAD
>>>>>>> new articles
title: ´î½¨ÒÔÌ«·»Ë½Á´ºÍË½Á´¼¯Èº
date: 2018-03-16
categories: Çø¿éÁ´
tags: [Çø¿éÁ´, ÒÔÌ«·»]
---

[ÏÂÔØGeth](https://geth.ethereum.org/downloads/)

## ×¼±¸
´´½¨Ò»¸öÎªË½Á´×¨ÓÃµÄÏµÍ³ÓÃ»§£ºethPrivate ÔÚethPrivateµÄhomeÄ¿Â¼²Ù×÷¡£

²½Öè£º
1. ×¼±¸Ò»¸ö´´ÊÀ¿éÎÄ¼ş`genesis.json`
2. ÓÃ`genesis.json`³õÊ¼»¯Êı¾İµ½Ò»¸öÄ¿Â¼ `node1`
3. ÔÚ`node1`ÖĞÆô¶¯Ò»¸ö½Úµã
4. ÔÚÁíÒ»¸öÄ¿Â¼`node2`£¬ÖØ¸´2²Ù×÷£¬À´ÎªÁíÒ»¸ö½Úµã×ö³õÊ¼»¯
5. ÔÚ`node2`ÖĞÆô¶¯ÁíÒ»¸ö½Úµã£¨¶Ë¿ÚºÅÒªÇø·Ö¿ªÀ´£©
6. ÖØ¸´4,5²½ÖèÀ´Æô¶¯ÏÂÒ»¸ö½Úµã
7. ÔÚÆô¶¯µÄ½ÚµãÖĞÌí¼ÓÆäËû½Úµã


## ´´ÊÀ¿éÎÄ¼ş
´´ÊÀ¿éÎÄ¼şÓÃÀ´³õÊ¼»¯Êı¾İ£¬Èç¹ûË½Á´ÉÏµÄ½ÚµãÒª»¥Áª±ØĞëÓÃÍ¬Ò»¸ö´´ÊÀ¿éÎÄ¼şÀ´³õÊ¼»¯¡£

³õÊ¼»¯Ö®ºó£¬Æô¶¯½ÚµãÊ±²»»áÔÙ¶ÁÈ¡¸ÃÎÄ¼ş¡£

ÎÄ¼şÊ¾ÀıÈçÏÂ£º`/home/ethPrivate/genesis.json`
<<<<<<< HEAD
=======
=======
title: æ­å»ºä»¥å¤ªåŠç§é“¾å’Œç§é“¾é›†ç¾¤
date: 2018-03-16
categories: åŒºå—é“¾
tags: [åŒºå—é“¾, ä»¥å¤ªåŠ]
---

[ä¸‹è½½Geth](https://geth.ethereum.org/downloads/)

## å‡†å¤‡
åˆ›å»ºä¸€ä¸ªä¸ºç§é“¾ä¸“ç”¨çš„ç³»ç»Ÿç”¨æˆ·ï¼šethPrivate åœ¨ethPrivateçš„homeç›®å½•æ“ä½œã€‚

æ­¥éª¤ï¼š
1. å‡†å¤‡ä¸€ä¸ªåˆ›ä¸–å—æ–‡ä»¶`genesis.json`
2. ç”¨`genesis.json`åˆå§‹åŒ–æ•°æ®åˆ°ä¸€ä¸ªç›®å½• `node1`
3. åœ¨`node1`ä¸­å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹
4. åœ¨å¦ä¸€ä¸ªç›®å½•`node2`ï¼Œé‡å¤2æ“ä½œï¼Œæ¥ä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹åšåˆå§‹åŒ–
5. åœ¨`node2`ä¸­å¯åŠ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆç«¯å£å·è¦åŒºåˆ†å¼€æ¥ï¼‰
6. é‡å¤4,5æ­¥éª¤æ¥å¯åŠ¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
7. åœ¨å¯åŠ¨çš„èŠ‚ç‚¹ä¸­æ·»åŠ å…¶ä»–èŠ‚ç‚¹


## åˆ›ä¸–å—æ–‡ä»¶
åˆ›ä¸–å—æ–‡ä»¶ç”¨æ¥åˆå§‹åŒ–æ•°æ®ï¼Œå¦‚æœç§é“¾ä¸Šçš„èŠ‚ç‚¹è¦äº’è”å¿…é¡»ç”¨åŒä¸€ä¸ªåˆ›ä¸–å—æ–‡ä»¶æ¥åˆå§‹åŒ–ã€‚

åˆå§‹åŒ–ä¹‹åï¼Œå¯åŠ¨èŠ‚ç‚¹æ—¶ä¸ä¼šå†è¯»å–è¯¥æ–‡ä»¶ã€‚

æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š`/home/ethPrivate/genesis.json`
>>>>>>> new articles
>>>>>>> new articles
```
{
	"config": {
			"chainId": 200,
			"homesteadBlock": 0,
			"eip155Block": 0,
			"eip158Block": 0
	},
	"coinbase" : "0x0000000000000000000000000000000000000000",
	"difficulty" : "0xffffff",
	"extraData" : "0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fb",
	"gasLimit" : "0xffffffff",
	"nonce" : "0x0000000000000000",
	"mixhash" : "0x0000000000000000000000000000000000000000000000000000000000000000",
	"parentHash" : "0x0000000000000000000000000000000000000000000000000000000000000000",
	"timestamp" : "0x00",
	"alloc": {
		"de1e758511a7c67e7db93d1c23c1060a21db4615":{"balance":"300000"},
		"27dc8de9e9a1cb673543bd5fce89e83af09e228f":{"balance":"500000"}
	}
}
```

<<<<<<< HEAD
=======
<<<<<<< HEAD
>>>>>>> new articles
key|ËµÃ÷
---|---
alloc | ÓÃÀ´Ô¤ÖÃÕËºÅÒÔ¼°ÕËºÅµÄÒÔÌ«±ÒÊıÁ¿¡£ÒòÎªË½ÓĞÁ´ÍÚ¿ó±È½ÏÈİÒ×£¬ËùÒÔ²»ĞèÒªÔ¤ÖÃÓĞ±ÒµÄÕËºÅ¡£
nonce | Éú³ÉµÄ¹¤×÷Ö¤Ã÷µÄÉ¢ÁĞ¡£×¢ÒâËüºÍ mixhash µÄÉèÖÃĞèÒªÂú×ãÒÔÌ«·»µÄ Yellow paper,4.3.4.Block Header Validity,£¨44£©ÕÂ½ÚËùÃèÊöµÄÌõ¼ş¡£
difficulty | ÉèÖÃµ±Ç°Çø¿éµÄÄÑ¶È£¬Èç¹ûÄÑ¶È¹ı´ó£¬CPU ÍÚ¿ó¾ÍÔ½ÄÑ£¬ÕâÀïÉèÖÃ½ÏĞ¡ÄÑ¶È£¬·½±ã CPU ÍÚ¿ó£¬Ê®Áù½øÖÆ¡£
mixhash | Óë nonce ÅäºÏÓÃÓÚÍÚ¿ó£¬ÓÉÉÏÒ»¸öÇø¿éµÄÒ»²¿·ÖÉú³ÉµÄ hash¡£×¢ÒâËüºÍ nonce µÄÉèÖÃĞèÒªÂú×ãÒÔÌ«·»µÄ Yellow paper,4.3.4.Block Header Validity,£¨44£©ÕÂ½ÚËùÃèÊöµÄÌõ¼ş¡£
coinbase | ¿ó¹¤µÄÕËºÅ£¬¿ÉÒÔÔÚ´´½¨Ë½Á´Ö®Ç°µ¼ÈëÒÑ¾­´´½¨ºÃµÄÕËºÅ¡£
parentHash | ÉÏÒ»¸öÇø¿éµÄ hash Öµ£¬´´Ê¼Çø¿éÃ»ÓĞÉÏÒ»¸öÇø¿é£¬ËùÒÔÉèÖÃÎª 0¡£
extraData | ¸½¼ÓĞÅÏ¢£¬¿ÉÒÔÌîĞ´ÈÎÒâĞÅÏ¢£¬ÒÑ´ïµ½Ë½ÓĞÁ´µÄ¸öĞÔ»¯£¬¿ÉÒÔ¼ÓÈë×Ô¼ºµÄÃû×ÖµÈ¡£
gasLimit | ¸ÃÖµÉèÖÃ¶Ô GAS µÄÏûºÄ×ÜÁ¿ÏŞÖÆ£¬ÓÃÀ´ÏŞÖÆÇø¿éÄÜ°üº¬µÄ½»Ò×ĞÅÏ¢×ÜºÍ£¬Ë½ÓĞÁ´¿ÉÒÔÉèÖÃÎª×î´óÖµ¡£


> Èç¹û´´Ê¼¿éÎÄ¼ş»òÕßÍøÂçid²»Ò»Ñù£¬½ÚµãÎŞ·¨»¥Áª

### ÍÚ¿óÄÑ¶È
³õÊ¼¿éµÄÄÑ¶ÈÖµ¾ö¶¨Õû¸öÁ´µÄËÙ¶È. 
difficultyÖµ | Ê®½øÖÆ | Éú³ÉËÙ¶È
--|--|--
2ffffd | 3145725 | Ò»·ÖÖÓÎåµ½Ê®¸öÖ®¼ä¸ö
5ffffa | 6291450 | Ò»·ÖÖÓÎå¸ö
bffff4 | 12582900 | Áù·ÖÖÓÍÚÁË°Ë¸ö
3bfffc4| 62914500 | Áù·ÖÖÓÁ½¸ö
77fff88| 125829000 | Ê®·ÖÖÓÁ½¸ö
12bffed4 | 314572500 | 15·ÖÖÓÃ»ÓĞÒ»¸ö

## ´î½¨ÍøÂç
### ³õÊ¼»¯ºÍÆô¶¯
```bash
#³õÊ¼»¯Á½¸ö½Úµã
geth --datadir /home/ethPrivate/node0 init genesis.json
geth --datadir /home/ethPrivate/node1 init genesis.json

#ºóÌ¨Æô¶¯µÚÒ»¸ö½Úµã£¬ÍøÂçid200£¬¶Ë¿Ú2001
nohup geth --datadir /home/ethPrivate/node0 --networkid 200 --port 2001 --nodiscover > /dev/null 2>&1 &
#ºóÌ¨Æô¶¯µÚ¶ş¸ö½Úµã£¬ÍøÂçid200£¬¶Ë¿Ú2011£¬rpc¶Ë¿Ú2012
nohup geth --datadir /home/ethPrivate/node1 --networkid 200 --port 2011 --nodiscover > /dev/null 2>&1 &
```

### Ìí¼Ó½Úµã
½ÚµãÆô¶¯ºó¿ÉÒÔÍ¨¹ıipc£¬rpc£¬websocketµÈ·½Ê½Óë½ÚµãÍ¨ĞÅ¡£ÔÚÍ¬Ò»Ì¨»úÆ÷ÉÏÒ»°ãÊ¹ÓÃgeth µÄipcÁ´½Ó·½Ê½¡£²»ÔÚÍ¬Ò»Ì¨»úÆ÷ÔòÊ¹ÓÃÆäËû·½Ê½¡£

ipcÁ´½Óºó¶Ô½ÚµãµÄ²Ù×÷²»ÊÜÏŞÖÆ¡£ÆäËû·½Ê½ÔòĞèÒªµ¥¶À¿ªÆô£¬²¢ÇÒ¿ÉÄÜĞèÒª¶Ô¸÷ÖÖÄ£¿éµÄ¿ª·Å·ÃÎÊÏŞÖÆ¡£

```
#Á´½Óµ½µÚ1¸ö½Úµã
geth attach ipc:/home/ethPrivate/node0/geth.ipc

#²é¿´½ÚµãĞÅÏ¢
<<<<<<< HEAD
=======
=======
key|è¯´æ˜
---|---
alloc | ç”¨æ¥é¢„ç½®è´¦å·ä»¥åŠè´¦å·çš„ä»¥å¤ªå¸æ•°é‡ã€‚å› ä¸ºç§æœ‰é“¾æŒ–çŸ¿æ¯”è¾ƒå®¹æ˜“ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢„ç½®æœ‰å¸çš„è´¦å·ã€‚
nonce | ç”Ÿæˆçš„å·¥ä½œè¯æ˜çš„æ•£åˆ—ã€‚æ³¨æ„å®ƒå’Œ mixhash çš„è®¾ç½®éœ€è¦æ»¡è¶³ä»¥å¤ªåŠçš„ Yellow paper,4.3.4.Block Header Validity,ï¼ˆ44ï¼‰ç« èŠ‚æ‰€æè¿°çš„æ¡ä»¶ã€‚
difficulty | è®¾ç½®å½“å‰åŒºå—çš„éš¾åº¦ï¼Œå¦‚æœéš¾åº¦è¿‡å¤§ï¼ŒCPU æŒ–çŸ¿å°±è¶Šéš¾ï¼Œè¿™é‡Œè®¾ç½®è¾ƒå°éš¾åº¦ï¼Œæ–¹ä¾¿ CPU æŒ–çŸ¿ï¼Œåå…­è¿›åˆ¶ã€‚
mixhash | ä¸ nonce é…åˆç”¨äºæŒ–çŸ¿ï¼Œç”±ä¸Šä¸€ä¸ªåŒºå—çš„ä¸€éƒ¨åˆ†ç”Ÿæˆçš„ hashã€‚æ³¨æ„å®ƒå’Œ nonce çš„è®¾ç½®éœ€è¦æ»¡è¶³ä»¥å¤ªåŠçš„ Yellow paper,4.3.4.Block Header Validity,ï¼ˆ44ï¼‰ç« èŠ‚æ‰€æè¿°çš„æ¡ä»¶ã€‚
coinbase | çŸ¿å·¥çš„è´¦å·ï¼Œå¯ä»¥åœ¨åˆ›å»ºç§é“¾ä¹‹å‰å¯¼å…¥å·²ç»åˆ›å»ºå¥½çš„è´¦å·ã€‚
parentHash | ä¸Šä¸€ä¸ªåŒºå—çš„ hash å€¼ï¼Œåˆ›å§‹åŒºå—æ²¡æœ‰ä¸Šä¸€ä¸ªåŒºå—ï¼Œæ‰€ä»¥è®¾ç½®ä¸º 0ã€‚
extraData | é™„åŠ ä¿¡æ¯ï¼Œå¯ä»¥å¡«å†™ä»»æ„ä¿¡æ¯ï¼Œå·²è¾¾åˆ°ç§æœ‰é“¾çš„ä¸ªæ€§åŒ–ï¼Œå¯ä»¥åŠ å…¥è‡ªå·±çš„åå­—ç­‰ã€‚
gasLimit | è¯¥å€¼è®¾ç½®å¯¹ GAS çš„æ¶ˆè€—æ€»é‡é™åˆ¶ï¼Œç”¨æ¥é™åˆ¶åŒºå—èƒ½åŒ…å«çš„äº¤æ˜“ä¿¡æ¯æ€»å’Œï¼Œç§æœ‰é“¾å¯ä»¥è®¾ç½®ä¸ºæœ€å¤§å€¼ã€‚


> å¦‚æœåˆ›å§‹å—æ–‡ä»¶æˆ–è€…ç½‘ç»œidä¸ä¸€æ ·ï¼ŒèŠ‚ç‚¹æ— æ³•äº’è”

### æŒ–çŸ¿éš¾åº¦
åˆå§‹å—çš„éš¾åº¦å€¼å†³å®šæ•´ä¸ªé“¾çš„é€Ÿåº¦. 
difficultyå€¼ | åè¿›åˆ¶ | ç”Ÿæˆé€Ÿåº¦
--|--|--
2ffffd | 3145725 | ä¸€åˆ†é’Ÿäº”åˆ°åä¸ªä¹‹é—´ä¸ª
5ffffa | 6291450 | ä¸€åˆ†é’Ÿäº”ä¸ª
bffff4 | 12582900 | å…­åˆ†é’ŸæŒ–äº†å…«ä¸ª
3bfffc4| 62914500 | å…­åˆ†é’Ÿä¸¤ä¸ª
77fff88| 125829000 | ååˆ†é’Ÿä¸¤ä¸ª
12bffed4 | 314572500 | 15åˆ†é’Ÿæ²¡æœ‰ä¸€ä¸ª

## æ­å»ºç½‘ç»œ
### åˆå§‹åŒ–å’Œå¯åŠ¨
```bash
#åˆå§‹åŒ–ä¸¤ä¸ªèŠ‚ç‚¹
geth --datadir /home/ethPrivate/node0 init genesis.json
geth --datadir /home/ethPrivate/node1 init genesis.json

#åå°å¯åŠ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç½‘ç»œid200ï¼Œç«¯å£2001
nohup geth --datadir /home/ethPrivate/node0 --networkid 200 --port 2001 --nodiscover > /dev/null 2>&1 &
#åå°å¯åŠ¨ç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œç½‘ç»œid200ï¼Œç«¯å£2011ï¼Œrpcç«¯å£2012
nohup geth --datadir /home/ethPrivate/node1 --networkid 200 --port 2011 --nodiscover > /dev/null 2>&1 &
```

### æ·»åŠ èŠ‚ç‚¹
èŠ‚ç‚¹å¯åŠ¨åå¯ä»¥é€šè¿‡ipcï¼Œrpcï¼Œwebsocketç­‰æ–¹å¼ä¸èŠ‚ç‚¹é€šä¿¡ã€‚åœ¨åŒä¸€å°æœºå™¨ä¸Šä¸€èˆ¬ä½¿ç”¨geth çš„ipcé“¾æ¥æ–¹å¼ã€‚ä¸åœ¨åŒä¸€å°æœºå™¨åˆ™ä½¿ç”¨å…¶ä»–æ–¹å¼ã€‚

ipcé“¾æ¥åå¯¹èŠ‚ç‚¹çš„æ“ä½œä¸å—é™åˆ¶ã€‚å…¶ä»–æ–¹å¼åˆ™éœ€è¦å•ç‹¬å¼€å¯ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦å¯¹å„ç§æ¨¡å—çš„å¼€æ”¾è®¿é—®é™åˆ¶ã€‚

```
#é“¾æ¥åˆ°ç¬¬1ä¸ªèŠ‚ç‚¹
geth attach ipc:/home/ethPrivate/node0/geth.ipc

#æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
>>>>>>> new articles
>>>>>>> new articles
> admin.nodeInfo.enode
"enode://07007...cf6fa@[::]:2001?discport=0"
> exit

<<<<<<< HEAD
=======
<<<<<<< HEAD
>>>>>>> new articles
#Á´½Óµ½µÚ2¸ö½Úµã
geth attach ipc:/home/ethPrivate/node1/geth.ipc

#²é¿´»ï°é½Úµã
> admin.peers
[]
#Ìí¼Ó»ï°é½Úµã
> admin.addPeer('enode://07007...cf6fa@[::]:2001?discport=0')
true
#ÔÙ´Î²é¿´»ï°é½Úµã
<<<<<<< HEAD
=======
=======
#é“¾æ¥åˆ°ç¬¬2ä¸ªèŠ‚ç‚¹
geth attach ipc:/home/ethPrivate/node1/geth.ipc

#æŸ¥çœ‹ä¼™ä¼´èŠ‚ç‚¹
> admin.peers
[]
#æ·»åŠ ä¼™ä¼´èŠ‚ç‚¹
> admin.addPeer('enode://07007...cf6fa@[::]:2001?discport=0')
true
#å†æ¬¡æŸ¥çœ‹ä¼™ä¼´èŠ‚ç‚¹
>>>>>>> new articles
>>>>>>> new articles
> admin.peers

[{
    caps: ["eth/63"],
    id: "07007...cf6fa",
    name: "Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9.2",
    network: {
      localAddress: "[::1]:37098",
      remoteAddress: "[::1]:2001"
    },
    protocols: {
      eth: {
        difficulty: 6291450,
        head: "0x3358e132db6a144c73f09605055def2720dc954983aa40c046ba8ca735e9e9d2",
        version: 63
      }
    }
}]
> exit
```
<<<<<<< HEAD
=======
<<<<<<< HEAD
>>>>>>> new articles
Ë½Á´ÍøÂç´î½¨Íê³É¡£


## ×Ô¶¯»¯Æô¶¯½Å±¾

#### ³õÊ¼»¯½Å±¾
<<<<<<< HEAD
=======
=======
ç§é“¾ç½‘ç»œæ­å»ºå®Œæˆã€‚


## è‡ªåŠ¨åŒ–å¯åŠ¨è„šæœ¬

#### åˆå§‹åŒ–è„šæœ¬
>>>>>>> new articles
>>>>>>> new articles
```
#!/bin/bash
node=$(( $1 + 0 ))
owner=ethPrivate
geth=/usr/local/bin/geth
init_file=/home/ethPrivate/genesis.json
netid=200
node_path=/home/ethPrivate/node${node}

if [ $EUID == 0 ];then
	su ${owner} -
fi

if [ `whoami` != ${owner} ];then
	echo "erro user"
	exit 0
fi

if [ -d $node_path ]
then
	echo "${node_path} exists."
	exit 0
else
	mkdir ${node_path}
fi

cat > $init_file <<FILEDATA
{
	"config": {
			"chainId": ${netid},
			"homesteadBlock": 0,
			"eip155Block": 0,
			"eip158Block": 0
	},
	"coinbase" : "0x0000000000000000000000000000000000000000",
	"difficulty" : "0x5ffffa",
	"extraData" : "0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fb",
	"gasLimit" : "0xffffffff",
	"nonce" : "0x0000000000000000",
	"mixhash" : "0x0000000000000000000000000000000000000000000000000000000000000000",
	"parentHash" : "0x0000000000000000000000000000000000000000000000000000000000000000",
	"timestamp" : "0x00",
	"alloc": {}
}
FILEDATA

cmd="${geth} --datadir ${node_path} init ${init_file}"
echo $cmd
$cmd
```

<<<<<<< HEAD
#### Æô¶¯½Úµã½Å±¾
=======
<<<<<<< HEAD
#### Æô¶¯½Úµã½Å±¾
=======
#### å¯åŠ¨èŠ‚ç‚¹è„šæœ¬
>>>>>>> new articles
>>>>>>> new articles

```
#!/bin/bash
geth=/usr/local/bin/geth

node=$(( $1 + 0 ))
node_path=/home/ethPrivate/node${node}
if [ ! -d $node_path ];then
	echo "node path error:${node_path}"
	exit 0
fi

netid=200
port=$((2000 + $node * 10))
rpc_port=$((2001 + $node * 10))
websocket_port=$((2002 + $node * 10))
identity="${netid}_${port}"
ip_list="192.168.1.80"
log=${node_path}/nohup.log

if [ `ps -fe | grep geth | grep ${port} | grep -v 'grep' | wc -l` -gt 0 ];then
	echo "node is running"
	exit 0
fi

cmd="
nohup ${geth} \
--datadir ${node_path} \
--identity ${identity} \
--networkid ${netid} --port ${port} \
--nodiscover --maxpeers 3 \
--wsport ${websocket_port} \
--wsaddr ${ip_list} \
--wsapi 'db,eth,net,web3' \
--rpc --rpccorsdomain '*.anxindeli.com' \
--rpcport ${rpc_port} \
--rpcaddr ${ip_list} \
--rpcapi 'db,eth,net,web3,personal,admin' > ${log} 2>&1 &
"

echo $cmd

echo "connect cmd: geth attach ipc:${node_path}/geth.ipc"
```